--
-- ME$REDIM_kontrola_hostname
--

REDIM kontrola connect stringu z TARGET_PROPERTIES

REDIM - kontrola na úplnost vyplnění hostname včetně domény v connect stringu

-- single instance, hostname z MachineName
    select
       t.target_name "db",
       lower(machine.property_value) "hostname"
       --count(*) cnt
    from SYSMAN.MGMT$TARGET t
       JOIN SYSMAN.MGMT$TARGET_PROPERTIES machine on (t.TARGET_GUID=machine.TARGET_GUID) -- machine
       where t.type_qualifier3     = 'DB'
       and   t.target_type         = 'oracle_database'
       AND   machine.PROPERTY_NAME = 'MachineName'
       AND machine.property_value not like '%.cz'
    UNION ALL
-- RAC, hostname ze scanName
    select
       t.target_name "db",
       lower(c.hostname) "hostname"
       --count(*) cnt
     from   SYSMAN.MGMT$TARGET t
       JOIN SYSMAN.MGMT$TARGET_PROPERTIES dp ON (t.TARGET_GUID=dp.TARGET_GUID)
       JOIN (
          SELECT t.target_name cluster_name,
          c.Property_Value hostname
     FROM
       SYSMAN.MGMT$TARGET t JOIN SYSMAN.MGMT$TARGET_PROPERTIES c 
         ON (t.TARGET_GUID=c.TARGET_GUID)
     WHERE
          t.target_type   = 'cluster'
      AND c.property_name = 'scanName'
      AND c.Property_Value not like '%.cz'
      ) c ON (dp.Property_Value = c.cluster_name)
       where t.type_qualifier3 = 'DB'
       and t.target_type = 'rac_database'
       and dp.property_name = 'ClusterName'
;